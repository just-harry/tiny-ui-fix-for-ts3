# Tiny UI Fix for The Sims 3

## Changelog

### Version 1.3.2

#### User-facing

- To improve mod compatibility, the layout-scaler is now more tolerant of expected XML nodes being absent.
- To improve the usability of patchset load-order auto-completion in PowerShell 5.1, `*` will now auto-complete to all available patchsets.
- When checking for updates, "ModTheSims" is now "Mod The Sims".

### Version 1.3.1

#### User-facing

- The `tiny-ui-fix-for-ts3.command` file in the `tiny-ui-fix-for-ts3.command.zip` download for macOS is now executable by default when extracted by Finder on macOS 10.15-and-later (10.15 is macOS Catalina).
- Links now look a bit nicer in the configurator.
- When an update is available, the "Check for updates" button in the configurator will now link to the Mod The Sims listing for the Tiny UI Fix, in addition to its GitHub repository.

#### Developer-side

- The implementation for setting file-permissions in a zip-archive using only the standard-library is comical, give it a peek in `Building/Package-SingleFileDistributables.ps1`.

### Version 1.3.0

#### User-facing

- The generated `tiny-ui-fix.package` file will now function correctly when it is generated on a system with a locale that does not use dots for decimal-points.
- A compatibility patchset is now included for LazyDuchess's Smooth Patch package.
- Recommended patchsets are now listed before other patchsets in the configurator. (Excluding the Nucleus and Vanilla Core DLL Compatibility Patches patchsets, which always come first).
- There is now command-line argument-completion for the `PatchsetLoadOrder` parameter of the `Use-TinyUIFixForTS3.ps1` script.
- A bug which caused an error to occur when an error was logged from outside the context of a catch statement was fixed. (Non-lexical scoping is great until it's not.)

#### Developer-side

- The `Apply-ConvenientPatchesToAssemblies` function can now scale doubles.

### Version 1.2.2

#### User-facing

- An error caused by the invalid XML error handling, introduced by version 1.2.1, was fixed.
- Errors that occur during layout scaling are now logged with more detail.

### Version 1.2.1

#### User-facing

- Errors are now printed with more detail, to make troubleshooting easier.
- Errors caused by XML resources consisting of invalid XML are now handled more gracefully—the offending XML resources are skipped.

### Version 1.2.0

#### User-facing

- In some circumstances, S3SA resources with the lowest priority would be included in the generated `tiny-ui-fix.package` file, instead of the resources with the highest priority.
This has been fixed to correctly use the resources with the highest priority. \
As a consequence of this, the Tiny UI Fix should no longer be incompatible with simler90's Gameplay Core Mod.

### Version 1.1.1

#### User-facing

- On Windows, if the "Controlled folder access" setting is enabled and is preventing the script from writing to the user-data folder of the Sims 3 installation that's being scaled, then the script will offer to temporarily allow PowerShell to access controlled folders.

### Version 1.1.0

#### User-facing

- The Tiny UI Fix no longer conflicts with the usage of CC Magic—the script now has the ability to edit the settings of CC Magic to ensure that the package generated by the Tiny UI Fix is always loaded. \
And, `Resource.cfg` files that have been edited by CC Magic can now be correctly processed by the Tiny UI Fix; see the next entry of this list for more detail on that.
- Evaluation of `Resource.cfg` files is now more accurate to how the game processes such files. \
Previously, only the `Priority` and `PackedFile` directives were recognised, and only a subset of their possible usage was recognised. With this update, the `Priority`, `PackedFile`, `DirectoryFiles`, `Scan`, and `StopScan` directives are recognised; additionally, quoted directive operands are now recognised, as are directives with comma-separated arguments following their operands. Nested `Resource.cfg` files that are implicitly referenced via a `PackedFile` or `DirectoryFiles` directive are also evaluated.
- `Use-TinyUIFixForTS3.ps1` now has two parameters which can be used to override the paths for the installation of The Sims 3 that's being patched, they are: `OverrideSims3Path` and `OverrideSims3UserDataPath`. The primary purpose of these parameters is to enable non-interactive usage of the script on platforms other than Windows and macOS.
- The game's text can now be scaled independently of the game's UI. (As suggested by u/U_Cam_Sim_It on Reddit).

#### Developer-side

- The `Tools/Update-VersionNumber.ps1` script now updates the version numbers of the `TinyUIFixForTS3` and `TinyUIFixForTS3CoreBridge` assemblies.

### Version 1.0.5

#### User-facing

- Layout and text-style scaling no longer fails when the system-locale does not use a dot for decimal-points.

### Version 1.0.4

#### User-facing

- There is now a button, in the configurator, for checking for updates to the Tiny UI Fix.
- The generated `tiny-ui-fix.package` is now saved to `Mods/TinyUIFix/tiny-ui-fix.package` instead of `Mods/Overrides/tiny-ui-fix.package`, to ensure that the Tiny UI Fix package is loaded after the packages that it scales. The script will automatically add an entry to the `Resource.cfg` file to set-up a priority for the package—if a `Resource.cfg` file does not exist, one will be created. Old `tiny-ui-fix.package` files in `Mods/Overrides/tiny-ui-fix.package` will be deleted automatically, so there's no need to worry about cleaning them up manually.
- The version of the Tiny UI Fix script is now printed on start-up.
- The version of a patchset is now logged alongside its ID.
- The assembly names of all the assemblies that are initially resolved are now printed. Hopefully, this should help to diagnose patchsets failing to identify assemblies by name.
- Mod folders containing exactly one package file no longer cause an `Unable to index into an object of type System.Collections.Generic.Dictionary`2[System.UInt64,System.Collections.Generic.IEnumerable`1[System.Object]]` error to occur.
- Errors that occur when a layout is being scaled are now handled gracefully: the layout is skipped, and the resource-key and the package of the layout is logged.

#### Developer-side

- The `Building/Build-All.ps1` script no longer fails on the first build, as the core-bridge is now correctly built before the patch and patcher.
- There is now a `Tools/Update-VersionNumber.ps1` script to update the version number of the Tiny UI Fix script in all the places it should be updated in.

### Version 1.0.3

- A regression introduced by version 1.0.2, which caused the `Apply-ConvenientPatchesToAssemblies` function to fail to scale the descendant fields of field-chains starting with an instance field was fixed.
- As a result of the fix to `Apply-ConvenientPatchesToAssemblies`, interaction-queue items are once again scaled properly.

### Version 1.0.2

- The `Apply-ConvenientPatchesToAssemblies` function is now capable of scaling the descendant fields of fields loaded by-reference (via the `ldsflda` and `ldflda` op-codes), so long as the terminal field is loaded by-value and the field loaded by-reference isn't of an array type.
- As a result of the enhancement to `Apply-ConvenientPatchesToAssemblies`, the methods for the enhanced family-tree dialog added by NRaas Master Controller are now patched correctly by the `CompatibilityPatchesForNRaasMods` patchset, resulting in the game no longer freezing when that dialog is opened. (Thanks to u/U_Cam_Sim_It on Reddit for the bug-report).
- The graphics that display on the screen when taking a photo are no longer incorrectly positioned. (Thanks to u/nubyplays on Reddit for the bug-report).
- The `Package-SingleFileDistributables.ps1` script now emits a zipped version of the Batch file for Windows which can be run successfully when it's opened within Windows Explorer (in preparation for the archive that will be submitted to Mod The Sims).
- Some informatory warnings are printed when an installation of The Sims 3 doesn't seem to have been set-up for modding.

### Version 1.0.1

* A failed attempt to fix a glitch that caused the game to freeze when an NRaas Master Controller enhanced family-tree dialog was opened, even when the `CompatibilityPatchesForNRaasMods` patchset was active, was attempted.
